\chapter{ Среда разработки } \label{chapt3}

%45

Разработка большого приложения с участием огромного количества разработчиков требует умения координировать действия, отслеживать кто что сделать, разрешать конфликты одновременной правки файлов, отслеживать, что приложение работает корректно. Все это проблемы будут рассмотрены в этой главе.

\section{ Три правила} \label{sect3_1}

Разработка любого уровня приложение подразумевает соблюдение трёх основных правил:
\begin{itemize}
\item Управляй исходным кодом;
\item Используй одношаговую сборку;
\item Отслеживайте свои ошибки.

\end{itemize}

\section{ Управление исходным кодом} \label{sect3_2}

Неважно, один ли разработчик в проекте или сотня --- используйте систему контроля за исходных кодом. Если же Вы до сих пор не используете систему контроля версий --- Вам стоит немедленно остановить разработку и внедрить её.

\subsection{ Что значит управлять исходным кодом?} \label{sect3_2_1}

Умение в любой момент времени вернуться к ранее сделаным правкам --- есть суть управления исходным кодом. Многие студии разработки позволяют хранить историю изменений исходных кодов, но лишь до того, как вы закроете их и потеряете всю историю изменений. Некоторые форматы, как, например, Corel WordPerfect, хранят всю историю правок внутри себя, но таким образом размер файла растёт после каждой правки, что неминуемо приведет к <<жирному>> проекту. Умение хранить историю изменений называется версионирование.

\subsection{ Версионирование } \label{sect3_2_2}

Версионирование --- одна из главных особенностей управление исходным кодом, позволяющая в любой момент времени получить любую версию исходного кода. Работа с системой контроля версий  проходит по следующему алгоритму. Сначала пользователь делает клонирование исходного кода из внешнего репозитория ( места, где хранятся все версии исходного кода ), после этого вносит правки, и, наконец, фиксирует изменения в удаленном репозитории. Таким образом в репозитории появится новая версия документа. Каждая версия документа имеет уникальный идентификатор, называемый номером ревизии. Когда пользователь клонирует к себе фалы из репозитория, он всегда получает самую новую версию файла.

%47

\subsection{ Откат изменений } \label{sect3_2_3}

В системе контроля версий не было бы смысла, не будь там возможности в любой момент времени получить любую версию файла, отменив совершенные изменения. Получать состояние системы возможно по номеру ревизии, по дате и времени существования ревизии, по тэгам и веткам. Таким образом всегда есть возможность откатить исходный код на любой состояние.

\subsection{ Журналирование } \label{sect3_2_4}

Каждый раз при фиксировании изменений, разработчик может указать комментарий ( лог ). В комментарии можно описать внесенные изменения, причины и следствия изменений. В дальнейшем это комментарии помогут лучше определить какая ревизия за что отвечает.

\subsection{ Различия } \label{sect3_2_5}

Команда \textbf{diff} позволяет отобразить различия между двумя файлами. Различия выводиться в виде строк, которые были изменены, удалены, добавлены; при это сразу видно что было и что стало. Просматривая различия совместно с логами можно лучше понять причины внесенных изменений, а так же понять кто совершил эти изменения...

%48

\subsection{ Одновременная правка и слияния } \label{sect3_2_6}

Одновременное редактирование проекта подразумевает, что каждый редактор будет иметь своего пользователя в системе контроля версий. Таким образом можно журналировать все внесенные изменения конкретным пользователем.

Если два пользователя одновременно редактировали один и тот же файл, и попытались зафиксировать внесенные изменения, то неминуемо придётся выполнять слияние двух правок. Если же пользователи редактировали разные участки одного файла, то большинство система контроля версий смогут в автоматическом режиме разрешить все возникшие конфликты. Если же правился один и тот же участок кода, то неминуема ручное слияние.

На практике конфликты встречаются очень редко. Обычно они возникают если разработчики не часто обновляют свои рабочее версии с репозитория. Или же два разработчика работают над одним и тем же кодом, что говорит о плохой коммуникацией между ними.

Для версионирования бинарных файлов или изображений может потребоваться использование специализированных средства контроля версий.

\subsection{ Аннотации } \label{sect3_2_7}

Большинство систем контроля версий позволяют пользователю просмотреть данные по каждой строчке, где указаны время изменения, автор изменения, номер ревизии.

%49

Просмотр аннотации позволяет определить ревизию, где были внесены правки. По этим данным можно просмотреть лог фиксирования изменения, не просматривая каждую ревизию.

\subsection{ Обсуждение блокировок } \label{sect3_2_8}

Система контроля версий подразумевает, что любой пользователь может в любой момент времени редактировать любой файл. Но иногда возникает необходимость запретить другим пользователям вносить правки в определенный файл на время редактирования этого файла кем-то.

Блокировки несут два проблемы, с одной стороны одни полностью помогают избежать конфликтов, но не дают одновременной правки разных частей одного и того же документа, где не может быть конфликтов. Вторая проблема связана с тем, что кто-то может забыть снять блокировку с файла и тогда файл может остаться заблокированным надолго.

%50

\subsection{ Проекты и модули } \label{sect3_2_9}

Системы контроля версий позволяют группировать файлы и директории, превращая несколько файлов в один проект или модуль. Таким образом можно отслеживать изменения не только одиночного файла, но и всего проекта.

 \subsection{ Тэгирование } \label{sect3_2_10}
 
 Использование тегов позволяет делать снимок всего репозитория, то есть находясь в определенной ревизии, создание тега, позволит сохранить состояние всех файлов в репозитории на данный момент. Таким образом очень удобно помечать релизное состояние репозитория.
 
  \subsection{ Ветвление } \label{sect3_2_11}
  
  Последняя ревизии обычно называется головой. Иногда возникает необходимости в наличии больше двух голов. Для необходимо создать новую ветку в репозитории. То есть репозиторий создаст свою точную копию, называемую веткой. Можно работать и фиксировать изменения в каждую из ветвей.
  
Основная ветвь называется стволом. Именно в ней хранятся стабильные релизы. Остальные же ветви используются на создание нового функционала. Особенно это оправдывает себя, когда несколько разработчиков работают одновременно над разными новшествами в разным частях проекта. Ветвление помогает им не заботиться о поддержке кода, написанного другими разработчиками, а так же не зависеть от того, что другие разработчики зафиксировали в репозитории.

  \subsection{ Слияние } \label{sect3_2_12}
  
  Когда разработка нового функционала в отдельной ветке закончено, необходимо перенести все эти изменения в основную ветку. Это действие принято называть слиянием.
  
 %51
 
 Процесс слияния, так же как и фиксирования. требует  разрешения конфликтов. Чаще всего это происходит автоматически. Но иногда приходиться производить слияние и в ручном режиме.

Принято считать, что основная ветка --- очень особенная ветка. она никогда не вливается в другую. Лишь все ветки вливаются в неё.


\section{ Необходимые инструменты} \label{sect3_3}

Есть некоторые необходимые инструменты, которые позволяют улучшить результаты.

\subsection{ Командная строка и интеграция редактирования } \label{sect3_3_1}

Большинство систем контроля версий, так же как и множество продуктов распространяемых с открытым кодом, используют лишь режим работы в командной строке, что требует специфических навыков и знаний.

Современные операционный системы предлагают возможность работы с системой контроля версий по средствам графического интерфейса. Так же многие современные средства разработки имеют встроенную поддержку систем контроля версий ( или функционал расширяется с помощью дополнений).

Использование хороших редакторов  с интеграцией в командной строке позволит свободно пользоваться функционалом систем контроля версий даже тем разработчикам, кто плохо знаком с командной строкой.

%52

\subsection{ Web интерфейс } \label{sect3_3_2}

Большинство систем управления предоставляют удобный web-интерфейс, где в интерактивном режиме можно просматривать различные ветки, ревизии, каталоги и файлы. Web-интерфейс дает возможность использования всех возможностей систем контроля версий тем, кто не владеет навыками работы в консольном режиме.

\subsection{ Отправка отчетов о фиксировании изменений на почту } \label{sect3_3_2}

Отправка отчетов о произведенных фиксированиях позволяет отслеживать и моментально реагировать на все произошедшие изменения. Так менеджер проекта может сразу понять кто и куда внёс правки. А благодаря тому, что в письмо можно включить и произведенные изменения ---- можно отслеживать все события не заходя в систему контроля версий.

\subsection{ Отображение отчетов о фиксировании изменений в RSS ленту } \label{sect3_3_3}

 Использование RSS ленты аналогично использованию рассылки отчетов фиксирования.  Различия заключаются в том, что длина ленты ( кол-во отчетов ) ограничено, что не даст посмотреть старый изменения.
 
 %53
 
 \subsection{ Использование СУДБ для хранения информации о фиксированиях } \label{sect3_3_4}

Использование СУБД для хранения информации о фиксированиях позволяет строить более подробные отчеты по данным фиксироваий. Так можно с помощью таких данных и возможностей СУДБ быстро установить все ревизии, в которых были проведены изменения в конкретном файле.

 \subsection{ Действия после фиксирования } \label{sect3_3_5}
 
 Системы контроля версий дают возможность выполнять различные действия после фиксирования. Так, например, можно запустить тестирование основной ветки сразу после фиксирования в неё новых изменений.
 
 %54
 
\section{ Системы управления исходным кодом } \label{sect3_4}
 
Существует множество систем управления исходным кодом. Разные системы предоставляют различные дополнения и возможности. При выборе системы контроля версий необходимо так же учитывать наличие клиентов для операционной системы в которой производиться разработка, необходимость web-интерфейса, списка рассылок и прочее.

 \subsection{ The Revision Control Sustem (RCS) } \label{sect3_4_1}
 
 Предшественником современных систем контроля версий является RCS, разработанная Волтером Тичи в университете Пердью в начале восьмидесятых 20 века.
 
 RCS нельзя назвать полноценной системой контроля версий, ибо она предназначена для хранения ревизий одного файла, не имеет возможности удаленного использования, не поддерживает работу нескольких пользователей.
 
\subsection{ The Concurrent Versions System (CVS) } \label{sect3_4_2}

CVS была представлена в 1986 году Диком Груне в Брюссельском Свободном Университете, как система контроля версий для хранения больших проектов с большим количеством разработчиков и возможностью использования удаленных репозиториев.  CVS позволяет использовать удаленное управление, поддерживает работу  тегами, ветвление, слияния. блокировки и обычный функционал.

\textbf{Наличие клиента.} Поскольку CVS существует довольно давно, существуют клиенты под все операционные системы. Так же есть не только консольные клиенты, но и клиенты с графическим интерфейсом.

Так же большинство современных сред разработки имеют встроенную возможность работы с CVS.

\textbf{Web-интерфейс.} CVS имеет два основных web-интерфейса, которые очень похожи внешне и предоставляют базовый функционал. Обе системы возможно расширять за счет плагинов.

\textbf{Список расссылки и RSS лента.} CVS поддерживает плагины, поэтому существуют расширения,  которые позволяют реализовать функционал рассылки писем послее фиксирования изменений, а так же публиковать изменения в RSS ленту.

Система расширений позволяет реализовать запуск тестирования после каждого фиксирования и прочие возможности.

\textbf{База данных фиксирований.} CVS поддерживает Bonsai --- база данных для фиксирований, созданная Терри Вейнссманом в качестве проекта Mozilla и написана на Perl. Система реализует весь функционал баз данных фиксирований.

\textbf{Плюсы.}
\begin{itemize}
\item Бесплатно --- говорит само за себя;
\item Используется многими и проверено временем;
\item Доступны реализации клиентов и серверов для всех платформ.
\end{itemize}

\textbf{Минусы.}
\begin{itemize}
\item Версионирование на уровне файлов, а не репозитория --- CVS не предоставляет возможности зафиксировать изменения нескольких файлов одним фиксированием. Каждый файл получит разный номер ревизии, тем самым нарушается атомарность операции фиксирования;
\item Невозможно переименовать или переместить файл --- поскольку CVS хранит история ревизий каждого файла в отдельном файле, невозможно переименовать или переместить файл. Для переименования файла необходимо удалить старый и создать новый, со старым содержимым, что неминуемо приведет к потере всей истории.
\end{itemize}

%57

\subsection{ Subversion(SVN) } \label{sect3_4_3}

Subversion --- это проект с открытым исходным кодом, который стартовал в 2000 году с четкой целью исправит все ошибки VCS. 

Subversion, в отличии от VCS, хранит всю историю фиксирований в базе данных, что позволяет избежать основных проблем VCS.

\textbf{Наличие клиента.} Subversion появляется на всё больших операционных системах. Есть графические интерфейсы, интеграции в различные среды разработки.

\textbf{Web-интерфейс.} Есть несколько хороших решений для  работы с этой системой контроля версий через интернет. Они представлены websvn, trac и Chora (которая так же поддерживает CVS).

\textbf{Список расссылки и RSS лента.} Subversion так же как и CVS предоставляет механизм, который позволяет после успешного фиксирования запускать различные расширение, которые в свою очередь могут отправлять изменения на почту или в RSS ленту.

\textbf{База данных фиксирований.} Subversion имеет клон Bonsai, названый Kamikaze, который написан на Perl и использует MySQL в качестве основного хранилища.

\textbf{Плюсы.}
\begin{itemize}
\item Бесплатно --- говорит само за себя;
\item Атомарность операции фиксирования;
\item Позволяет перемещать и переименовывать файлы.
\end{itemize}

%58

\textbf{Минусы.}
\begin{itemize}
\item Ненадёжное хранилище --- по умолчанию Subversion использует в качестве хранилища BerkleyDB. При падении Subversion может сломать и BerkleyDB, что приведет к повреждению хранилища. Начиная с версии 1.2 Subversion может использовать в качестве хранилища FSFS, которая решает проблемы надежности BerkleyDB.

\item Тяжело скомпилировать --- Subversion тяжело собрать из исходных кодов, поэтому сейчас она поставляется в виде скомпилированных бинарных файлов.
\end{itemize}


\subsection{ Perforce } \label{sect3_4_4}

Perforce --- коммерческий продукт, реализующий систему контроля версий. Естественно он не бесплатный, но за плату так же можно получить техническую поддержку, что является плюсом для многих компаний.

Perforce использует ту же идеологию в названиях, что и остальные системы контроля версий, только репозитории называются складами.

%59

\textbf{Наличие клиента.} Perforce имеет собственный клиент, который обычно и выбирают разработчики. Графический клиент доступен для ОС Windows, который позволяет кроме обычных функций возможность просматривать репозитории и отслеживать изменения. Perforce имеет API, который позволяет писать плагины для различных систем.

\textbf{Web-интерфейс.} Perforce имеет собственный web-интерфейс для просмотра репозиториев, который предоставляет функционал схожий с CVS и Subversion. Он бесплатен для всех пользователей Perforce.

\textbf{Список расссылки и RSS лента.} Perforce так же как и CVS и Subversion предоставляет механизм, который позволяет после успешного фиксирования запускать различные расширение, которые в свою очередь могут отправлять изменения на почту или в RSS ленту.

\textbf{База данных фиксирований.} Поддержка Perforce в Bonsai лишь запланирована.

\textbf{Плюсы.}
\begin{itemize}
\item Атомарность операции фиксирования;
\item Система прав доступа;
\item Коммерческая поддержка.
\end{itemize}



\textbf{Минусы.}
\begin{itemize}
\item Стоимость лицензии для одного пользователя составляет от 500 до 800 долларов. Проекты с открытым исходным кодом могут пользоваться системой бесплатно.
\end{itemize}

%60


\subsection{ Visual Source Safe (VSS) } \label{sect3_4_5}

VSS --- система контроля версий компании Microsoft. Ранее это был отдельный продукт, но ныне входит в в состав Visual Studio. В прошлом VSS могла работать только в проприаретарном режиме, блокирую доступ к файлу всем, кроме того, кто его редактирует; но сейчас поддерживается одновременное редактирование несколькими пользователями.

\textbf{Наличие клиента.} Официальный клиент доступен только на ОС Windows. Так же лишь немного среды разработки имеют поддержку VSS. Есть неофициальные реализации клиент для других операционных систем.

\textbf{Web-интерфейс.} Заявлено о наличии web-интерфейса, но он до сих пор не представлен и информации о нём крайне мало.

\textbf{Список расссылки и RSS лента.} На данный момент не реализованы возможности отправки изменений на почту или в ленту RSS.

\textbf{База данных фиксирований.} На данный момент отсутствуют какие-либо реализации.

\textbf{Плюсы.}
\begin{itemize}
\item Лёгкая интеграция в Visual Studio.
\end{itemize}



\textbf{Минусы.}
\begin{itemize}
\item Отсутствие атомарных списков изменений;
\item Отсутствие возможности переместить или переименовать файл;
\item Отсутствие аннотаций или пометок о том, кто сделал правку;
\item Отсутствие полноценной поддержки работы по сети.
\end{itemize}

\subsection{ В заключении } \label{sect3_4_6}

Представленные четыре продукта являются широко используемым на данный момент в разработке web-приложений.

\subsection{ Итоги } \label{sect3_4_7}

На данный момент самый лучший выбор --- Subversion, ибо она реализует наибольшее количество возможностей, а так же поддерживает сторонние приложения.

Если вы уже используете систему контроля версий и она исправно работает, то не стоит её менять, ибо переезд может вызвать множество проблем как с конвертированием репозиториев, так и с применением клиентов в различных ОС.

Конечно, если нужна поддержка, можно использовать и Perforce, но поработав с Subversion, можно понять, что поддержка не нужна.

%62

\section{ Что хранить в системе контроля версий } \label{sect3_5}

Обычно в системе контроля версий хранится исходный код, статичный файлы и изображения. Но это не единственный подход для организации хранения данных в системах контроля версий.

\subsection{ Документация } \label{sect3_5_1}

Хранения документации проекта в системе контроля версий позволяет решить несколько проблем и улучшить процесс разработки.

Так при одновременной правке исходников и документации с последующим фиксированием позволяет иметь актуальную документацию в любой момент, а это означает, что любая ревизия будет содержать верную документацию, относящуюся именно к текущему состоянию проекта.

Документация рядом с исходным кодом позволяет не тратить время на поиски документации. Так же документация в системе контроля версий, при наличии web-интерфейса, позволяет получить доступ к ней в любом месте даже там, где нету возможности выкачать исходный код из системы контроля версий.

\subsection{ Конфигурационные файлы программного обеспечения } \label{sect3_5_2}

%63

В Unix подобных системах конфигурация приложения хранится в обычны файлах. Поэтому их очень удобно хранить в системах контроля версий, рядом с исходным кодом. Таким образом мы получим актуальные настройки  в любой ревизии.

Конфигурационные файлы в системе контроля версий помогут быстрее развернуть проект на новом оборудовании и вернуть в строй на текущем сервере после некоторой поломки.

\subsection{ Инструменты постройки проекта } \label{sect3_5_3}

Все скрипты, которые помогают собирать проект, должны так же хранится в репозитории. Надо взять правило, что всё что может быть изменено хотя бы раз --- должно находиться в репозитории.

\section{ Что не стоит хранить в системе контроля версий } \label{sect3_6}

Если проект компилирует исходники в бинарные файлы, то в репозиторий имеет смысл складывать только исходный код, скрипты для сборки и инструкции. Бинарные файлы в репозитории не могут быть сравнены между разными версиями, что в корне нарушает всю идеологию систем контроля версий.

%64

\section{ Сборка проекта в один шаг } \label{sect3_7}

По мере роста проекта и внедрения нового функционала процесс сборки становится многошаговым и требует выполнения различных действия в разных местах. Такой процесс может сломаться на каком-то из шагов, что может привести к катастрофе. Поэтому необходимо всё автоматизировать и привести процесс сборки проекты к нажатию одной кнопки, которая сделать все необходимые действия.

\section{ Резать по живому } \label{sect3_8}







 
 
 

 



































\clearpage



